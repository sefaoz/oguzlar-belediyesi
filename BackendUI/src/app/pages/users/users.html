<div class="grid grid-cols-12 gap-4">
    <div class="col-span-12">
        <div class="card mb-4">
            <div class="flex items-center">
                <i class="pi pi-home mr-2 text-gray-500 cursor-pointer" routerLink="/"></i>
                <span class="text-gray-500 mr-2">&gt;</span>
                <span class="font-medium text-gray-900 dark:text-gray-100">Kullanıcı Yönetimi</span>
            </div>
        </div>
    </div>

    <div class="col-span-12">
        <div class="card">
            <div class="flex items-center justify-between mb-4">
                <h5 class="m-0 text-lg font-semibold">Kullanıcılar</h5>
                <button pButton pRipple label="Yeni Kullanıcı Ekle" icon="pi pi-plus" class="p-button-success"
                    (click)="openNew()"></button>
            </div>

            <p-table #dt [value]="users" [rows]="10" [paginator]="true" [rowsPerPageOptions]="[5, 10, 20]"
                [globalFilterFields]="['username', 'role']" [tableStyle]="{'min-width': '50rem'}" [rowHover]="true"
                dataKey="id"
                currentPageReportTemplate="Toplam {totalRecords} kayıttan {first} ile {last} arası gösteriliyor"
                [showCurrentPageReport]="true" styleClass="p-datatable-striped">

                <ng-template pTemplate="caption">
                    <div class="flex justify-end">
                        <div class="relative w-full md:w-auto">
                            <i class="pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 z-10"></i>
                            <input pInputText type="text"
                                (input)="dt.filterGlobal($any($event.target).value, 'contains')" placeholder="Ara..."
                                class="pl-10! w-full md:w-64" />
                        </div>
                    </div>
                </ng-template>

                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="username">Kullanıcı Adı <p-sortIcon field="username"></p-sortIcon></th>
                        <th pSortableColumn="role">Rol <p-sortIcon field="role"></p-sortIcon></th>
                        <th pSortableColumn="createdDate">Oluşturulma Tarihi <p-sortIcon
                                field="createdDate"></p-sortIcon></th>
                        <th class="text-right">İşlemler</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-user>
                    <tr>
                        <td class="font-medium">{{user.username}}</td>
                        <td>{{user.role}}</td>
                        <td>{{user.createdDate | date:'dd.MM.yyyy HH:mm'}}</td>
                        <td class="text-right">
                            <button pButton pRipple icon="pi pi-pencil" class="p-button-text p-button-info mr-2"
                                (click)="editUser(user)"></button>
                            <button pButton pRipple icon="pi pi-trash" class="p-button-text p-button-danger"
                                (click)="deleteUser(user)"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>

<p-dialog [(visible)]="userDialog" [style]="{width: '450px'}" header="Kullanıcı Detayları" [modal]="true"
    styleClass="p-fluid" [draggable]="false" [resizable]="false">
    <ng-template pTemplate="content">
        <div class="flex flex-col gap-4 pt-4">
            <div class="field">
                <label for="username" class="font-medium text-gray-600 dark:text-gray-300 mb-2 block">Kullanıcı
                    Adı</label>
                <input type="text" pInputText id="username" [(ngModel)]="user.username" required autofocus />
                <small class="p-error block mt-1" *ngIf="submitted && !user.username">Kullanıcı adı gereklidir.</small>
            </div>

            <div class="field">
                <label for="role" class="font-medium text-gray-600 dark:text-gray-300 mb-2 block">Rol</label>
                <p-select [options]="roles" [(ngModel)]="user.role" optionLabel="label" optionValue="value"
                    appendTo="body" styleClass="w-full"></p-select>
                <small class="p-error block mt-1" *ngIf="submitted && !user.role">Rol gereklidir.</small>
            </div>

            <div class="field">
                <label for="password" class="font-medium text-gray-600 dark:text-gray-300 mb-2 block">Şifre</label>
                <p-password [(ngModel)]="user.password" [toggleMask]="true" [feedback]="false" placeholder="******"
                    styleClass="w-full" inputStyleClass="w-full"></p-password>
                <small class="text-gray-500 block mt-1" *ngIf="user.id">Şifreyi değiştirmek istemiyorsanız boş
                    bırakın.</small>
                <small class="p-error block mt-1" *ngIf="submitted && !user.id && !user.password">Şifre
                    gereklidir.</small>
            </div>
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <div class="flex justify-end gap-2 pt-2">
            <button pButton pRipple label="Vazgeç" icon="pi pi-times" class="p-button-text p-button-secondary"
                (click)="hideDialog()"></button>
            <button pButton pRipple label="Kaydet" icon="pi pi-check" class="p-button-primary"
                (click)="saveUser()"></button>
        </div>
    </ng-template>
</p-dialog>

<p-blockUI [blocked]="isLoading" [baseZIndex]="99999">
    <div class="flex flex-col items-center justify-center gap-3"
        style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white;">
        <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
        <div class="font-bold text-xl">İşlem Gerçekleştiriliyor...</div>
        <div class="text-sm">Lütfen bekleyiniz.</div>
    </div>
</p-blockUI>

<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>